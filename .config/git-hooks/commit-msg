#!/bin/bash

# Global commit message validator
# Validates commit title (max 50 chars) and body lines (max 72 chars)

commit_regex='^.{1,50}$'
body_regex='^.{0,72}$'

# Read commit message
message=$(cat "$1")

# Split into lines
IFS=$'\n' read -d '' -r -a lines <<< "$message"

errors=0

# Check title (first line)
if ! [[ "${lines[0]}" =~ $commit_regex ]]; then
    echo "Error: Commit title must be 1-50 characters"
    echo "  Title: '${lines[0]}' (${#lines[0]} chars)"
    ((errors++))
fi

# Check body lines (skip title and empty lines)
for i in "${!lines[@]}"; do
    if [[ $i -gt 0 && -n "${lines[i]}" ]] && ! [[ "${lines[i]}" =~ $body_regex ]]; then
        echo "Error: Body line $((i+1)) exceeds 72 characters"
        echo "  Line: '${lines[i]}' (${#lines[i]} chars)"
        ((errors++))
    fi
done

if [[ $errors -gt 0 ]]; then
    echo ""
    echo "Found $errors validation error(s). Please fix and try again."
    exit 1
fi

echo "Commit message format validated âœ“"